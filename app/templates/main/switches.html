{% extends 'menu.html' %}

{% block header %}Switches in {{ ecosystem_ids[1] }}{% endblock %}
{% block info %}{% endblock %}

{% set switches = {"light": light_data} %}
{% set modes = ("on", "off", "automatic") %}

{% block content %}
  {% for switch in switches %}
  <div class="row">
    <div class="board max400OnScreen">
      <h1>{{ switch.capitalize() }} switch</h1>
      <div class="boardRowContainer">
        <div class="switchStatusContainer">
          <div class="centered">
            <i class="fas fa-sync-alt" id="{{ switch }}_status" style="font-size: 165px; margin: auto"></i>
          </div>
        </div>
        <div class="boardColumnContainer" style="margin: auto; min-width: 0;">
          {% for mode in modes %}
          {% if current_user.is_operator %}
          <button id="{{ switch }}_{{ mode }}" title="Turn {{ switch }} {{ mode }}">{{ mode.capitalize() }}</button>
          {% else %}
          <button id="{{ switch }}_{{ mode }}" disabled title="You need to be an operator to turn {{ switch }} {{ mode }}">{{ mode.capitalize() }}</button>
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>



  {% endfor %}
{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        {% for switch in switches %}
        if ({{ switches[switch][ecosystem_ids[0]]["status"]|toJSBool }}) {
            $("i#{{ switch }}_status").addClass("on");
        } else {
            $("i#{{ switch }}_status").addClass("off");
        }
        if ("{{ switches[switch][ecosystem_ids[0]]["mode"] }}" == "automatic") {
            $("i#{{ switch }}_status").addClass("fa-spin");
        }

        socket.on("{{ switch }}_data", function(msg) {
            if (msg.{{ ecosystem_ids[0] }}.status) {
                $("i#{{ switch }}_status").addClass("on");
                $("i#{{ switch }}_status").removeClass("off");
            } else {
                $("i#{{ switch }}_status").addClass("off");
                $("i#{{ switch }}_status").removeClass("on");
            }
            if (msg.{{ ecosystem_ids[0] }}.mode == "automatic") {
                $("i#{{ switch }}_status").addClass("fa-spin");
            } else {
                $("i#{{ switch }}_status").removeClass("fa-spin");
            }
        });

        {% if current_user.is_operator %}
        {% for mode in modes %}
        $("button#{{ switch }}_{{ mode }}").click(function() {
            socket.emit("turn_{{ switch }}", {ecosystem: "{{ ecosystem_ids[0]|safe }}", mode: "{{ mode }}" });
            return false;
        });
        {% endfor %}
        {% endif %}
        {% endfor %}
    </script>
{% endblock %}