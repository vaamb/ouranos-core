{% extends 'menu.html' %}

{% block header %}Switches in {{ecosystem_ids[1]}}{% endblock %}
{% block info %}{% endblock %}

{% block content %}
  {% if current_user.is_operator %}

  {{ light_data }}

  {% if light_data[ecosystem_ids[0]]["status"] %}
    {% set status_now = "on" %}
  {% else %}
    {% set status_now = "off" %}
  {% endif %}

  {% if light_data[ecosystem_ids[0]]["mode"] == "automatic" %}
    {% set mode_now = "fa-spin" %}
  {% else %}
    {% set mode_now = "" %}
  {% endif %}

  <i class="fas fa-power-off {{ status_now }}" id="status_ico"></i>
  <i class="fas fa-sync {{ mode_now }} {{ status_now }}" id="mode_ico"></i>

  <button id="On" title="Turn lights on">On</button>
  <button id="Off" title="Turn lights on">Off</button>
  <button id="Auto" title="Turn lights to automatic mode">Auto</button>
  {% else %}
  <button id="On" disabled title="You need to be an operator to turn lights on">On</button>
  <button id="Off" disabled title="You need to be an operator to turn lights off">Off</button>
  <button id="Auto" disabled title="You need to be an operator to turn lights to automatic mode">Auto</button>
  {% endif %}
{% endblock %}

{% block scripts %}
    {% if current_user.is_operator %}
    <script type="text/javascript">
    let status = {{ light_data[ecosystem_ids[0]]["status"] }};
    let mode = '{{ light_data[ecosystem_ids[0]]["mode"] }}';

    $("button#On").click(function() {
        socket.emit("turn_light_on", {ecosystem: "{{ecosystem_ids[0]|safe}}" });
        return false;
    });
    $("button#Off").click(function() {
        socket.emit("turn_light_off", {ecosystem: "{{ecosystem_ids[0]|safe}}"});
        return false;
    });
    $("button#Auto").click(function() {
        socket.emit("turn_light_auto", {ecosystem: "{{ecosystem_ids[0]|safe}}"});
        return false;
    });
    {% endif %}
  </script>
{% endblock %}