{% extends 'menu.html' %}

{% block header %}Services management{% endblock %}
{% block info %}{% endblock %}

{% block content %}
<div class="board">
  <form>
    <table>
      <tbody>
        {% for service in services %}
        <tr>
          <td>{{ service.name.capitalize() | removeUnderscores }} </td>
          <td>
            <label class="switch">
              <input type="checkbox" {{ 'checked' if service.status else '' }} id="{{ service.name }}_toggle">
              <span class="slider"></span>
            </label>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
let Services = {{ services | tojson }};

$(function () {
  for (const service of Services) {
    $("#"+ service.name + "_toggle").change(function () {
      if (this.checked) {
        socketAdmin.emit("manage_service",
          {user_id: "{{ current_user.id }}",
           service: service.name,
           action: "start"}
        );
      } else {
        socketAdmin.emit("manage_service",
          {user_id: "{{ current_user.id }}",
           service: service.name,
           action: "stop"}
        );
      }
    });
  }
});
</script>
{% endblock %}